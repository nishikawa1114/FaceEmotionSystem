= FaceEmotion System 
Ryosuke Nishikawa
v1.0 2020-10-21
:doctype: book
:toc: left
:toclevels: 3
:toc-title: 目次
:sectnums:
:sectnumlevels: 3
:icons: font
:imagesdir: img
:figure-caption: 図

== 機能概要

このシステムは、画像に映っている人の表情から感情を分析する。

=== ユースケース一覧
[cols="1,3", options="header"]
|===
|No.
|ユースケース名

|<<_画像を表示する, UC01>>
|画像を表示する

|<<_画像を分析する, UC02>>
|画像を分析する

|===

=== ユースケース図

[plantuml]
--
@startuml FaceEmotion

left to right direction
actor ユーザー
actor 表情分析システム
rectangle FaceEmotion{
    ユーザー --> (UC01: 画像を表示する)
    ユーザー --> (UC02: 画像を分析する)

    (UC02: 画像を分析する) <-- 表情分析システム
}

@enduml
--

== 画面仕様

=== 画面遷移


[plantuml]
--
@startuml screen transition

hide empty description
[*] -right-> ホーム画面
分析結果画面 -left--> ホーム画面 : 戻るボタン押下
分析結果画面 --> エラー画面 : 分析結果が取得できなかった場合
ホーム画面 -right-> 分析結果画面 : 画像を選択して分析ボタン押下
ホーム画面 --> エラー画面 : 画像が取得できなかった場合
エラー画面 --> ホーム画面 : ホーム画面へ戻るボタン押下

@enduml
--

=== 画面

==== ホーム画面
image::home.png[home, 600]
[cols="1,4a" options="header"]
|===
|名称
|説明

|URL入力フォーム
|表示したい画像のURLを入力する。

|表示ボタン
|表示ボタンを押下することで、URL入力フォームに入力された画像が画像表示領域に表示される。

|画像表示領域
|画像を表示する。画像をクリックすることで選択、選択解除できる。 + 
一列に4枚まで表示する。 

* 表示可能枚数上限：40枚

|分析ボタン
|分析画面に移動し、選択された画像の分析結果を表示する。

|===

==== 分析結果画面

image::analyzed.png[analyzed, 600]
　分析結果に複数人のデータが含まれている場合、分析結果は縦に並んで人数分表示する。分析可能人数の上限を超えた人数が画像内に写っている場合、分析可能人数分のみ分析結果を表示する。その場合、分析する人物の選択はできない。

* 分析可能人数上限：10人

[cols="1,4a" options="header"]
|===
|名称
|説明

|画像情報表示領域
|画像のユーザー名、日付の情報を表示する。

|画像表示領域
|分析対象の人物の顔をトリミングして表示する。

|グラフ領域
|分析結果のグラフをレーダーチャートで表示する。

|表領域
|分析結果の数値を表示する。 + 

|戻るボタン
|ボタンを押下するとホーム画面へ移動する。
|===



==== エラー画面
image::err.png[err, 600]

[cols="1,4a", options="header"]
|===
|名称
|説明

|メッセージ領域
|エラーに対応するメッセージを表示する。

|ホーム画面へ戻るボタン
|ボタンを押下するとホーム画面へ移動する。

|===

CAUTION: 画像は、ボタン、フォームなどの配置のイメージです。

== ユースケース記述

=== システム起動
[cols="1,4a" options="header"]
|===
|ユースケースID
|該当なし

|機能名称
|サービス起動

|概要
|ホーム画面を表示する

|アクター
|* ユーザー


|事前条件
|-

|事後条件
|* ホーム画面が表示されていること

|基本フロー
|. ブラウザにURLを入力する

|代替フロー
|-

|例外フロー
|-

|===

=== 画像を表示する
[cols="1,4a" options="header"]
|===
|ユースケースID
|UC01

|機能名称
|画像を表示する

|概要
|URLを入力して画像を表示する。

* 表示可能枚数上限：40枚


|アクター
|* ユーザー

|事前条件
|* ホーム画面が表示されていること

|事後条件
|* 画像が表示されていること

|基本フロー
|. ユーザーはURLをフォームに入力する
. ユーザーは「表示」ボタンを押下する
* [red]#URLが未入力の場合# ⇒ <<display-Alt-1, Alt-1へ移動>>
* [red]#URLが正しくない場合# ⇒ <<display-Err-1, Err-1へ移動>>
* [red]#画像の表示枚数が表示可能枚数上限に達している場合# ⇒ <<display-Err-2, Err-2へ移動>>
. システムは対応する画像を表示する


|代替フロー
|
[[display-Alt-1]]
* Alt-1 URLが未入力の場合
. 表示ボタン押下不可
. 基本フローのステップ1に戻る

|例外フロー
|
[[display-Err-1]]
* Err-1 URLが正しくない場合
. エラー画面へ遷移
. メッセージ表示領域にメッセージ01を表示する

[[display-Err-2]]
* Err-2 画像の表示枚数が表示可能枚数上限に達している場合
. 表示ボタン押下負荷

|備考
|
画像に対応する以下の情報を画面に表示する

* ユーザー名
* 日付

|===

=== 画像を分析する

[cols="1,4a" options="header"]
|===
|ユースケースID
|UC02

|機能名称
|画像を分析する

* 分析可能人数上限：10人

|概要
|画像を選択して、表情を分析する。

|アクター
|* ユーザー
* 表情分析システム

|事前条件
|* ホーム画面が表示されていること
* UC01を実行済みであること
* 画像が表示されていること

|事後条件
|* 分析結果画面が表示されていること

|基本フロー
|. ユーザーは画像をチェックボックスで選択する
. ユーザーは「分析」ボタンを押下する
* [red]#画像が選択されていない場合# ⇒ <<analyze-Alt-1, Alt-1に移動>>
. システムは表情分析システムに画像の分析を依頼する
. 表情分析システムはシステムに画像の分析結果を渡す
* [red]#分析結果がエラーの場合# ⇒ <<analyze-Err-1, Err-1に移動>>
. システムは画像の分析結果を表示する。分析結果に複数人のデータが含まれる場合には分析可能人数上限までの結果を表示する



|代替フロー
|
[[analyze-Alt-1]]
* Alt-1 画像が選択されていない場合
. 分析ボタン押下不可
. 基本フローのステップ1に戻る


|例外フロー
|
[[analyze-Err-1]]
* Err-1 表情分析システムからのレスポンスがエラーの場合
. エラー画面へ遷移
. メッセージ表示領域にメッセージ02を表示する

|備考
|分析結果には以下の感情値が含まれる

* 怒り
* 軽蔑
* 嫌悪感
* 恐怖
* 喜び
* 中立
* 悲しみ
* 驚き

|===


== メッセージ定義

[cols="1,9", options="header"]
|===
|ID
|メッセージ内容

|01
|画像が存在しません

|02
|分析結果が取得できませんでした

|===